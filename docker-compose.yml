services:
  hnrobert-omz-installer-test:
    image: ubuntu:22.04
    container_name: hnrobert-omz-installer-test
    stdin_open: true
    tty: true
    working_dir: /workspace
    volumes:
      - .:/workspace
    environment:
      - DEBIAN_FRONTEND=noninteractive
      - TERM=xterm-256color
    entrypoint: [
        "/bin/bash",
        "-lc",
        "set -e; \
        apt-get update; \
        apt-get install -y sudo; \
        id -u dev >/dev/null 2>&1 || useradd -m -s /bin/bash dev; \
        echo 'dev ALL=(ALL) NOPASSWD:ALL' > /etc/sudoers.d/dev; \
        chmod +x /workspace/install.sh; \
        su - dev -c 'cd /workspace && ./install.sh'; \
        exec su - dev -c '/bin/zsh -i'",
      ]
